<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>TINGO ADMIN - Tạo bài viết</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #d32f2f;
      --primary-dark: #b71c1c;
      --accent: #f97316;
      --bg: #f3f4f6;
      --text-main: #111827;
      --text-sub: #6b7280;
      --radius-lg: 16px;
      --radius-md: 10px;
      --shadow-soft: 0 16px 40px rgba(15,23,42,.12);
      --transition-fast: 180ms ease-out;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #fee2e2 0, #f3f4f6 45%, #e5e7eb 100%);
      color: var(--text-main);
      line-height: 1.6;
      min-height: 100vh;
    }

    /* ===== LOGIN WRAPPER ===== */
    #loginWrapper {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px 16px;
    }

    .login-card {
      width: 100%;
      max-width: 360px;
      background: rgba(255,255,255,.96);
      border-radius: 18px;
      padding: 20px 18px 18px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(243,244,246,.95);
      text-align: center;
      animation: fadeInUp 260ms ease-out;
    }

    .login-logo {
      height: 64px;
      margin-bottom: 8px;
    }

    .login-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .login-sub {
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 16px;
    }

    .login-field {
      text-align: left;
      margin-bottom: 10px;
    }

    .login-field label {
      font-size: 13px;
      font-weight: 500;
      display: block;
      margin-bottom: 4px;
    }

    .login-input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 8px 12px;
      font-size: 14px;
      outline: none;
      background: #f9fafb;
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
      text-align: center;
      letter-spacing: .24em;
      font-weight: 600;
    }

    .login-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(220,38,38,.25);
      background: #ffffff;
    }

    .login-button {
      width: 100%;
      border-radius: 999px;
      border: 0;
      padding: 9px 12px;
      margin-top: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      background: linear-gradient(to right, #fb923c, var(--accent));
      color: #ffffff;
      box-shadow: 0 10px 24px rgba(248,113,113,.4);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast);
    }

    .login-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 30px rgba(248,113,113,.5);
    }

    .login-error {
      font-size: 12px;
      color: #b91c1c;
      margin-top: 6px;
      min-height: 16px;
    }

    .login-hint {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 12px;
    }

    /* ===== ADMIN WRAPPER ===== */
    #adminWrapper {
      display: none;
      min-height: 100vh;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 40;
      backdrop-filter: blur(14px);
      background: rgba(255,255,255,.96);
      border-bottom: 1px solid rgba(209,213,219,.7);
    }

    .header-inner {
      max-width: 900px;
      margin: 0 auto;
      padding: 10px 16px 8px;
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
      justify-content: space-between;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .logo {
      height: 70px;
      max-width: 100%;
      display: block;
    }

    .header-text h1 {
      font-size: 20px;
      letter-spacing: .12em;
      text-transform: uppercase;
    }

    .header-text p {
      font-size: 11px;
      color: var(--text-sub);
      text-transform: uppercase;
      letter-spacing: .16em;
      margin-top: 3px;
    }

    .logout-btn {
      border-radius: 999px;
      border: 0;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
      background: #e5e7eb;
      color: #111827;
      transition: background var(--transition-fast), transform var(--transition-fast);
      white-space: nowrap;
    }

    .logout-btn:hover {
      background: #d1d5db;
      transform: translateY(-1px);
    }

    @media (max-width: 640px) {
      .header-inner {
        flex-direction: column;
        align-items: flex-start;
        text-align: left;
      }
      .header-left {
        width: 100%;
        justify-content: center;
        text-align: center;
      }
      .logo {
        height: 56px;
      }
      .header-text {
        text-align: left;
      }
      .header-inner .logout-btn {
        align-self: flex-end;
      }
    }

    .page-wrap {
      padding: 20px 16px 32px;
    }

    .grid {
      max-width: 900px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 18px;
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: rgba(255,255,255,.96);
      border-radius: var(--radius-lg);
      padding: 18px 18px 20px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(243,244,246,.95);
      animation: fadeInUp 320ms ease-out;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .card-desc {
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 14px;
    }

    .field {
      margin-bottom: 10px;
    }

    .field label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .field small {
      display: block;
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 2px;
    }

    input[type="text"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      padding: 7px 9px;
      font-size: 13px;
      font-family: inherit;
      outline: none;
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
      background: #f9fafb;
    }

    textarea {
      min-height: 110px;
      resize: vertical;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(220,38,38,.25);
      background: #ffffff;
    }

    .row {
      display: flex;
      gap: 10px;
    }

    .row .field {
      flex: 1;
    }

    .button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 14px;
      border-radius: 999px;
      border: 0;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      background: linear-gradient(to right, #fb923c, var(--accent));
      color: #ffffff;
      box-shadow: 0 10px 24px rgba(248,113,113,.4);
      margin-top: 6px;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast);
    }

    .button:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 32px rgba(248,113,113,.5);
    }

    .button-secondary {
      background: #e5e7eb;
      color: #111827;
      box-shadow: none;
      margin-left: 6px;
    }

    .output-label {
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .code-output {
      width: 100%;
      border-radius: 10px;
      border: 1px dashed #d1d5db;
      padding: 8px 9px;
      font-size: 12px;
      font-family: "SFMono-Regular", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background: #f9fafb;
      min-height: 200px;
      resize: vertical;
      white-space: pre;
    }

    .hint {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 6px;
    }

    .preview-title {
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 6px;
    }

    .preview-card {
      border-radius: 12px;
      background: linear-gradient(to right, #ffffff, #f9fafb);
      border: 1px solid #e5e7eb;
      padding: 10px 12px;
      box-shadow: 0 1px 4px rgba(15,23,42,.06);
      font-size: 13px;
    }

    .preview-card-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .preview-meta {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: var(--text-sub);
      margin-bottom: 4px;
    }

    .preview-summary {
      font-size: 12px;
      color: var(--text-sub);
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(6px); }
      to   { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body>
  <!-- ===== LOGIN SCREEN ===== -->
  <div id="loginWrapper">
    <div class="login-card">
      <img src="tingo-logo.png" alt="TINGO Logo" class="login-logo" />
      <div class="login-title">TINGO ADMIN</div>
      <div class="login-sub">Đăng nhập để quản lý bài viết</div>

      <div class="login-field">
        <label for="adminPassword">Mật khẩu</label>
        <input
          id="adminPassword"
          class="login-input"
          type="password"
          inputmode="numeric"
          autocomplete="off"
          maxlength="6"
          placeholder="••••••"
        />
      </div>

      <button id="loginButton" class="login-button">Đăng nhập</button>
      <div id="loginError" class="login-error"></div>
      <div class="login-hint">Trang admin chỉ dùng nội bộ, mật khẩu hiện tại: 6 chữ số.</div>
    </div>
  </div>

  <!-- ===== ADMIN UI ===== -->
  <div id="adminWrapper">
    <header>
      <div class="header-inner">
        <div class="header-left">
          <img src="tingo-logo.png" alt="TINGO Logo" class="logo">
          <div class="header-text">
            <h1>TINGO ADMIN</h1>
            <p>QUẢN LÝ BÀI VIẾT – SINH CODE CHO articles.js</p>
          </div>
        </div>
        <button id="logoutButton" class="logout-btn" type="button">Đăng xuất</button>
      </div>
    </header>

    <main class="page-wrap">
      <div class="grid">
        <!-- FORM BÊN TRÁI -->
        <section class="card">
          <div class="card-title">Tạo bài viết mới</div>
          <div class="card-desc">
            Điền thông tin bài viết, hệ thống sẽ sinh đoạn code để bạn dán vào <strong>articles.js</strong>.
          </div>

          <div class="field">
            <label for="title">Tiêu đề</label>
            <input id="title" type="text" placeholder="Nhập tiêu đề bài viết" />
          </div>

          <div class="row">
            <div class="field">
              <label for="category">Chuyên mục</label>
              <select id="category">
                <option value="Thời sự">Thời sự</option>
                <option value="Thể thao">Thể thao</option>
                <option value="Đời sống">Đời sống</option>
                <option value="Pháp luật">Pháp luật</option>
                <option value="Công nghệ">Công nghệ</option>
                <option value="Khác">Khác</option>
              </select>
            </div>
            <div class="field">
              <label for="date">Ngày</label>
              <input id="date" type="date" />
              <small>Nếu để trống, sẽ dùng ngày hôm nay.</small>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label for="id">ID bài viết</label>
              <input id="id" type="text" placeholder="VD: 1, 2, 3..." />
              <small>Dùng số tăng dần, không trùng ID cũ.</small>
            </div>
            <div class="field">
              <label for="slug">Slug (đường dẫn)</label>
              <input id="slug" type="text" placeholder="Sẽ tạo tự động từ tiêu đề nếu để trống" />
              <small>Không dấu, chữ thường, gạch ngang. VD: tran-derby-kich-tinh.</small>
            </div>
          </div>

          <div class="field">
            <label for="summary">Mô tả ngắn</label>
            <textarea id="summary" placeholder="Tóm tắt 1–2 câu, sẽ hiện ở phần Tin mới."></textarea>
          </div>

          <div class="field">
            <label for="media">Danh sách mã nhúng (gallery – ảnh &amp; video, không giới hạn)</label>
            <textarea id="media" placeholder="Dán mã nhúng &lt;img&gt;, &lt;iframe&gt; Dailymotion, &lt;video&gt;...
Mỗi khối media cách nhau bằng 1 DÒNG TRỐNG."></textarea>
            <small>
              Ví dụ:<br>
              - Ảnh: &lt;img src=&quot;images/anh1.jpg&quot; alt=&quot;Mô tả&quot; /&gt;<br>
              - Video Dailymotion (mã embed): &lt;iframe src=&quot;https://www.dailymotion.com/embed/video/VIDEO_ID&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;<br>
              Nhiều media: dán khối đầu, xuống 1 dòng trống, dán khối tiếp theo...
            </small>
          </div>

          <div class="field">
            <label for="content">Nội dung bài</label>
            <textarea id="content" placeholder="Mỗi dòng = 1 đoạn. Hệ thống sẽ tự bọc &lt;p&gt;...&lt;/p&gt;."></textarea>
          </div>

          <button id="generateBtn" class="button">Tạo code bài viết</button>
          <button id="clearBtn" class="button button-secondary" type="button">Xoá form</button>
          <div class="hint">
            Sau khi tạo xong, copy đoạn code ở khung bên phải, dán vào cuối mảng <strong>articles</strong> trong <code>articles.js</code>.
          </div>
        </section>

        <!-- OUTPUT + PREVIEW BÊN PHẢI -->
        <section class="card">
          <div class="preview-title">Xem trước thẻ Tin mới</div>
          <div id="previewCard" class="preview-card">
            <div class="preview-card-title" id="previewTitle">Tiêu đề bài viết sẽ hiện ở đây</div>
            <div class="preview-meta">
              <span id="previewDate">dd/mm/yyyy</span>
              <span id="previewCat">Chuyên mục</span>
            </div>
            <div class="preview-summary" id="previewSummary">
              Mô tả ngắn sẽ hiện ở đây.
            </div>
          </div>

          <div style="margin-top:14px;" class="output-label">
            Code thêm vào mảng <code>articles</code> trong <strong>articles.js</strong>:
          </div>
          <textarea id="codeOutput" class="code-output" readonly placeholder="// Bấm 'Tạo code bài viết' để sinh code..."></textarea>

          <button id="copyBtn" class="button button-secondary" type="button" style="margin-top:8px;">Copy code</button>
          <div class="hint">
            Mở <strong>articles.js</strong> trên GitHub &gt; Edit file &gt; dán đoạn code này vào cuối mảng <code>articles</code> (nhớ thêm dấu phẩy nếu cần) &gt; Commit.
          </div>
        </section>
      </div>
    </main>
  </div>

  <script>
    /* ====== LOGIN LOGIC ====== */
    const ADMIN_PASSWORD = "240802";
    const loginWrapper = document.getElementById("loginWrapper");
    const adminWrapper = document.getElementById("adminWrapper");
    const loginInput = document.getElementById("adminPassword");
    const loginButton = document.getElementById("loginButton");
    const loginError = document.getElementById("loginError");
    const logoutButton = document.getElementById("logoutButton");

    function showAdmin() {
      loginWrapper.style.display = "none";
      adminWrapper.style.display = "block";
    }

    function showLogin() {
      adminWrapper.style.display = "none";
      loginWrapper.style.display = "flex";
    }

    // Kiểm tra nếu đã đăng nhập trước đó
    if (localStorage.getItem("tingoAdminAuth") === "ok") {
      showAdmin();
    } else {
      showLogin();
    }

    function handleLogin() {
      const value = (loginInput.value || "").trim();
      if (value === ADMIN_PASSWORD) {
        localStorage.setItem("tingoAdminAuth", "ok");
        loginError.textContent = "";
        showAdmin();
      } else {
        loginError.textContent = "Mật khẩu không đúng, vui lòng thử lại.";
      }
    }

    loginButton.addEventListener("click", handleLogin);
    loginInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        handleLogin();
      }
    });

    if (logoutButton) {
      logoutButton.addEventListener("click", () => {
        localStorage.removeItem("tingoAdminAuth");
        loginInput.value = "";
        showLogin();
      });
    }

    /* ====== ADMIN LOGIC (sinh code bài viết) ====== */
    const titleInput = document.getElementById("title");
    const catInput = document.getElementById("category");
    const dateInput = document.getElementById("date");
    const idInput = document.getElementById("id");
    const slugInput = document.getElementById("slug");
    const summaryInput = document.getElementById("summary");
    const mediaInput = document.getElementById("media");
    const contentInput = document.getElementById("content");

    const previewTitle = document.getElementById("previewTitle");
    const previewDate = document.getElementById("previewDate");
    const previewCat = document.getElementById("previewCat");
    const previewSummary = document.getElementById("previewSummary");

    const generateBtn = document.getElementById("generateBtn");
    const clearBtn = document.getElementById("clearBtn");
    const copyBtn = document.getElementById("copyBtn");
    const codeOutput = document.getElementById("codeOutput");

    (function setDefaultDate() {
      const today = new Date();
      const y = today.getFullYear();
      const m = String(today.getMonth() + 1).padStart(2, "0");
      const d = String(today.getDate()).padStart(2, "0");
      dateInput.value = `${y}-${m}-${d}`;
      updatePreview();
    })();

    function updatePreview() {
      previewTitle.textContent = titleInput.value || "Tiêu đề bài viết sẽ hiện ở đây";
      previewCat.textContent = catInput.value || "Chuyên mục";

      const dateVal = dateInput.value;
      if (dateVal) {
        const [y, m, d] = dateVal.split("-");
        previewDate.textContent = `${d}/${m}/${y}`;
      } else {
        previewDate.textContent = "dd/mm/yyyy";
      }

      previewSummary.textContent = summaryInput.value || "Mô tả ngắn sẽ hiện ở đây.";
    }

    [titleInput, catInput, dateInput, summaryInput].forEach(el => {
      el.addEventListener("input", updatePreview);
    });

    function makeSlug(str) {
      return str
        .toLowerCase()
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "") // bỏ dấu
        .replace(/[^a-z0-9\s-]/g, "")                    // bỏ ký tự lạ
        .trim()
        .replace(/\s+/g, "-");
    }

    function formatDateDDMMYYYY(dateVal) {
      if (!dateVal) return "";
      const [y, m, d] = dateVal.split("-");
      return `${d}/${m}/${y}`;
    }

    function escapeBackticks(str) {
      return str.replace(/`/g, "\\`");
    }

    generateBtn.addEventListener("click", function (e) {
      e.preventDefault();

      const title = titleInput.value.trim();
      const category = catInput.value;
      const dateVal = dateInput.value;
      const summary = summaryInput.value.trim();
      const contentRaw = contentInput.value.trim();
      let idVal = idInput.value.trim();
      let slugVal = slugInput.value.trim();
      const mediaRaw = mediaInput.value.trim();

      if (!title || !summary || !contentRaw) {
        alert("Vui lòng nhập ít nhất: Tiêu đề, Mô tả ngắn và Nội dung bài.");
        return;
      }

      if (!idVal) {
        idVal = String(Date.now());
        idInput.value = idVal;
      }

      if (!slugVal) {
        slugVal = makeSlug(title);
        slugInput.value = slugVal;
      }

      const dateFormatted = formatDateDDMMYYYY(dateVal);

      const paragraphs = contentRaw
        .split("\n")
        .map(line => line.trim())
        .filter(line => line.length > 0)
        .map(line => `      <p>${escapeBackticks(line)}</p>`)
        .join("\n");

      const safeTitle = title.replace(/"/g, '\\"');
      const safeSummary = summary.replace(/"/g, '\\"');

      // Tách media theo khối, mỗi khối cách nhau ít nhất 1 dòng trống
      let mediaBlocks = [];
      if (mediaRaw) {
        mediaBlocks = mediaRaw
          .split(/\n\s*\n/g)
          .map(block => block.trim())
          .filter(block => block.length > 0);
      }
      const safeMediaBlocks = mediaBlocks.map(block => escapeBackticks(block));

      const lines = [];
      lines.push("{");
      lines.push(`  id: "${idVal}",`);
      lines.push(`  slug: "${slugVal}",`);
      lines.push(`  title: "${safeTitle}",`);
      lines.push(`  date: "${dateFormatted}",`);
      lines.push(`  category: "${category}",`);
      lines.push(`  summary: "${safeSummary}",`);

      if (safeMediaBlocks.length > 0) {
        lines.push("  mediaEmbeds: [");
        safeMediaBlocks.forEach((block, idx) => {
          const comma = idx === safeMediaBlocks.length - 1 ? "" : ",";
          lines.push("    `" + block + "`" + comma);
        });
        lines.push("  ],");
      }

      lines.push("  content: `");
      lines.push(paragraphs);
      lines.push("  `");
      lines.push("}");

      codeOutput.value = lines.join("\n");
      updatePreview();
    });

    clearBtn.addEventListener("click", function () {
      titleInput.value = "";
      summaryInput.value = "";
      contentInput.value = "";
      idInput.value = "";
      slugInput.value = "";
      mediaInput.value = "";
      codeOutput.value = "";
      updatePreview();
    });

    copyBtn.addEventListener("click", function () {
      if (!codeOutput.value.trim()) {
        alert("Chưa có code để copy. Hãy bấm 'Tạo code bài viết' trước.");
        return;
      }
      navigator.clipboard.writeText(codeOutput.value)
        .then(() => alert("Đã copy code vào clipboard!"))
        .catch(() => alert("Trình duyệt không cho copy tự động, bạn hãy tự Ctrl+C."));
    });
  </script>
</body>
</html>
